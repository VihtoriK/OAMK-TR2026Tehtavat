a) Luentomateriaalissa on esitetty, miten Arviointi-taulussa olevia arvosanoja voidaan kasvattaa yhdellä. Muuta aliohjelmaa niin, että on mahdollista tulla katumapäälle, eli arvosanoja voidaan myös laskea yhdellä. Tämä voidaan hoitaa esimerkiksi niin, että viedään IN-parametrilla aliohjelmaan + tai - -merkki ja IF-lauseella valitaan, kasvatetaanko vai vähennetäänkö arvosanaa yhdellä.


DELIMITER $$
CREATE DEFINER=`t3blaa00`@`localhost` PROCEDURE `kursori`( IN Operator VARCHAR(1) ) /* syötetään + tai -. oletuksena plussataan!! */ 
BEGIN
	/*Paikalliset muuttujat*/
	DECLARE arvos INT;
	DECLARE ID INT;
	DECLARE Num INT DEFAULT 1;  /* Defalttina plussataan 1 mutta jos miinustetaan asetetaan plussattavaksi arvoksi -1 */

	IF Operator = '-'
		Num = -1;
	END IF;

	/*Tosi, kun kursori menee taulun loppuun*/
	DECLARE done BOOLEAN;

	/*Haetaan kursoriin kaikki tiedot kahdesta sarakkeesta*/
	DECLARE arvos_cursor CURSOR for
	SELECT idArviointi,Arvosana FROM Arviointi;

	/* NOT FOUND-käsittelijä (kun rivit loppuu) */
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET done=TRUE;

	/*Avataan kursori*/
	OPEN arvos_cursor;

	/*Aloitetaan silmukka*/
	arvos_loop: loop

		/*Sijoitetaan kursorin arvot rivi kerrallaan muuttujiin*/
		FETCH arvos_cursor INTO ID,arvos;

		/*Kun kaikki luettu, silmukasta ulos*/
		IF done then
			CLOSE arvos_cursor;
			LEAVE arvos_loop;
		END IF;

		/*Päivitetään Arvosana-sarakkeen yksi rivi*/
		UPDATE Arviointi SET Arvosana=arvos+Num WHERE ID=idArviointi AND Arvosana < 5;
	END LOOP arvos_loop;
END



b) Tietotekniikan osasto päättää, että luokan TVT25SPL luokkatunnus vaihdetaan muotoon TVT25SP. Kirjoita kursori, joka muuttaa kaikkien kyseisen luokan opiskelijoiden luokkatunnukset (voit käyttää muitakin luokkatunnuksia, mitä Opiskelija-taulussa sattuu olemaan).



DELIMITER $$

CREATE PROCEDURE update_luokka_cursorilla()
BEGIN

	
	DECLARE ID INT;
	DECLARE done BOOLEAN DEFAULT FALSE;

	DECLARE update_luokka CURSOR FOR SELECT idOpiskelija FROM Opiskelija WHERE Luokkatunnus='TVT25SPL';

	DECLARE CONTINUE HANDLER FOR NOT FOUND SET done=TRUE;

	OPEN update_luokka;

	update_loop: loop
		FETCH update_luokka INTO ID;
		IF done then
			LEAVE update_loop;
		END IF;
		UPDATE Opiskelija SET Luokkatunnus='TVT25SP' WHERE idOpiskelija=ID;
	END LOOP update_loop;

	CLOSE update_luokka;

END